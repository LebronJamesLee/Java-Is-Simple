## Java Wechat Pay Project ZJ

###### 视频课程项目之微信支付系统——整个项目的完整生命周期。

> 开发流程——数据库设计——接口设计——开发、编码、部署功能到阿里云服务器、域名备案、解析到服务器、通过域名进行访问。



**项目核心功能：**

> 列表展示、视频详情、微信扫描登录、微信扫描支付、订单列表。

**面试题1：你在这个项目中充当什么角色？**

> 我在该项目中主要做：支付和扫描登录这些。

为什么不进行账号密码登录？用微信登录这样更加安全。



**一、项目的创建**

> 开发工具：IDEA

**二、开发的完整开发流程**

![](https://github.com/NolanJcn/Java-Is-Simple/blob/master/%5Bimg%5DJava%20Wechat%20Pay%20Project%20ZJ/%E4%BA%A7%E5%93%81%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B.png?raw=true)

**三、需求分析架构设计**

> **功能：**
>
> 视频列表、微信扫码登录、下单微信支付。
>
> **架构设计：**
>
> 前后端分离—>方案：node渲染
>
> （选择这个）动静分离—>方案：静态资源如html，js放在cdn或者nginx服务器上
>
> **技术选择：**
> 后端技术选择：IDEA + Springboot2.0 + redis4.0+ HttpClient + mysql + ActiveMQ消息队列
>
> 前端技术选择：HTML5 + bootstrapt + jquery
>
> 测试要求：首页和视频详情页qps单机qps要求 2000+

![](https://github.com/NolanJcn/Java-Is-Simple/blob/master/%5Bimg%5DJava%20Wechat%20Pay%20Project%20ZJ/%E6%9E%B6%E6%9E%84%E5%9B%BE.png?raw=true)

将页面列表信息缓存到redis中去，这样减少对数据库的访问。

用户点击浏览器，前端发送AJAX请求到nginx里去，nginx再分发到后端服务器。

**四、数据库设计**

![](https://github.com/NolanJcn/Java-Is-Simple/blob/master/%5Bimg%5DJava%20Wechat%20Pay%20Project%20ZJ/%E6%95%B0%E6%8D%AE%E5%BA%93er%E5%9B%BE.png?raw=true)

不关键的数据做缓存或者冗余，而不是做成实时的。

**er图：**

> 实体对象：矩形
> 属性：椭圆
> 关系：菱形

video表\video_order表\user表\comment表\chapter张\episode节

**字段冗余：**

> **什么是字段冗余**
>
> 冗余字段就是本存在一张表的字段，也出现在另一张表中。
>
> **什么时候选择字段冗余**
>
> 看需求，如果影响不大，利于开发效率，可适当的增加冗余字段。
>
> **优点**
>
> 不使用字段冗余，如果要查询所有数据，并用到其他表的一个字段，就要用join进行连接查询，那么当有很多表的时候，那么查询就很慢了。使用字段冗余，直接给表添加该字段就速度快多了。
>
> **缺点**				 
>
> 如果对该字段进行增删改，对应也要对那个表的字段进行增删改，这时还要去了解所有表中的冗余字段，以防有些表中的字段没对应修改。

Mysql测试数据导入。

刚开始肯定不是设计的很全面的，要结合业务设计。

**五、项目搭建、逆向工程构建、热部署、分层分包及资源文件处理、开源工具的选择/优缺点、接口配置文件自动映射到属性和实体类配置**

项目依赖：

> ```
> spring-boot-starter-data-redis
> spring-boot-starter-web
> spring-boot-starter-test
> spring-boot-devtools
> mybatis-spring-boot-starter
> mysql-connector-java
> druid
> pagehelper
> jjwt
> httpclient
> httpmime
> commons-codec
> commons-logging
> httpcore
> gson
> javase
> core
> ```

热部署。

项目目录结构：

```
controller
service
	impl
mapper
utils
domain
config
interceoter
dto
```

pageHeper分页拦截器：

> 好处：开发方便，使用简单，使用aop方式进行分页，只需要引入相关依赖，然后PageHelper.startPage(page, size);  开启分页。
> 弊端：对于分库分表等情况下使用有问题，深度分页逻辑判断会复杂。

**面试题2：写一个分页sql语句？**

> 问面试官数据量有多大、表字段多不多，根据情况分为普通分页与深度分页：
>
> 如果表数据万级别的，如果id自增，那么不使用limit去查询，而是通过where id条件过滤或者特定的字段对前面无用的数据进行过滤然后进行查询，因为深度分页会牵扯磁盘IO操作，影响性能。
>
> 并且应该指定字段去查询，而不是用*去全部查询。

```sql
select * from video limit 0,3
恶意深度分页攻击：
select * from video limit 1000005,3
改进：
select * from video where id > 1000004 limit 0,3
```

```
封装的好坏
关于抽象和不抽象的选择，比如tk这些工具，通用mapper，service，controller
好处：
代码量大大减少，开发新模块可以马上进行使用
弊端：
对应过度封装，新手等比较难理解，不能保证团队里面所有人都有对应的水平，或者有高度封装的思想，也不是过度封装
```

封装通用工具类，如缓存操作等、利于解耦，如切换缓存框架。

接口配置文件自动映射到属性和实体类配置。



**六、视频列表接口开发**

**七、整合Mybatis访问数据库和阿里巴巴数据源**

**八、使用Mybatis注解开发视频列表增删改查**

**九、Vidoe相关接口完善和规范协议**

**十、动态Sql语句Mybaties SqlProvider**

**十一、PageHelper分页插件使用**

**十二、JWT微服务下的用户登录权限校验**

**十三、单机和分布式应用的登录检验讲解**

**十四、微服务下登录检验解决方案 JWT讲解**

**十五、登录检验JWT实战之封装通用方法**

**十六、微信授权用户接口开发** 

**十七、数据信息安全--微信授权一键登录功能介绍**

**十八、微信扫一扫功能开发前期准备**

**十九、微信Oauth2.0交互流程讲解**

**二十、微信授权一键登录开发之授权URL获取**

**二十一、HttpClient4.x工具获取使用**

**二十二、微信扫码登录回调本地域名映射工具Ngrock**

**二十三、授权登录获取微信用户个人信息实战**

**二十四、用户模块开发之保存微信用户信息**

**二十五、使用JWT生成用户Token回写客户端**

**二十六、Springboot2.x用户登录拦截器开发实战**

**二十七、接入微信扫一扫网页支付**

**二十八、常用的第三方支付和聚合支付介绍**

**二十九、什么是聚合支付**

**三十、申请微信支付介绍和不同场景的支付方式**

**三十一、微信网站扫码支付介绍**

**三十二、互联网架构知识时序图讲解**

**三十三、微信网页扫码支付时序图讲解和统一下单接口**

**三十四、微信支付订单接口开发之订单增删改查**

**三十五、IDE生成订单接口单元测试和断言开发**

**三十六、微信统一下单接口开发之CommonUtils和WXpayUtils开发**

**三十七、微信支付Controller下单API接口开发**

**三十八、微信支付下单API接口和签名开发**

**三十九、调用微信统一下单接口实战**

**四十、谷歌二维码工具生成扫一扫支付二维码**

**四十一、微信支付扫码回调开发实战**

**四十二、微信回调处理之更新订单状态和幂等性讲解**

**四十三、微信支付之下单事务处理**

**四十四、全局异常处理和日志打点统计**

**四十五、配置SpringBoot2.0全局自定义异常**

**四十六、使用Logback整合SpringBoot打点日志**

**四十七、前后端联调和跨域处理**

**四十八、联调效果演示和还原接口代码**

**四十九、动静分离之前端项目静态页面引入和相关js包使用**

**五十、前后端分离 跨域问题讲解**

**五十一、首页视频列表页联调**

**五十二、微信扫一扫登录联调**

**五十三、网页扫码支付联调**

**五十四、生产环境搭建部署**

**五十五、云服务器介绍和阿里云服务器ECS服务器选购**

**五十六、阿里云服务器远程登录和常用工具**

**五十七、阿里云Linux服务器Centos7 安装JDK8环境**

**五十八、互联网架构知识之网站部署上线基础准备**

**五十九、域名购买和配置解析实战**

**六十、生产环境Linux服务器上Nginx介绍和安装**

**六十一、线上环境应用集群部署**

**六十二、前后端启动接入Nginx代理服务器**

**六十三、高可用处理之多节点集群部署**



























































杂七杂八：

项目技术：JWT/微服务登录鉴权功能。

点击购买，调用微信接口那边的二维码进行扫描支付，支付完后会在数据库插入一条数据。

接入微信支付。

每天进行日志的滚动。



















